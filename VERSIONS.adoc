= Versions

== Unreleased

== 0.4.1

* fix: RBI issues from overlapping names

== 0.4.0

* feat: Cache building is now immutable, allowing for more flexible and composable cache definitions.
* feat: Added `build_backend` and `build_backend!` methods to `CacheBuilder` to construct only a typed backend from the registry without a Store wrapper.

* fix: Broken default methods on Store

* refactor: CacheBuilder broken out into `CacheDefinition` and `CacheBuilder` interfaces.
* refactor: Make return result of CacheBuilder#build an untyped store, so it can be easily cast to other types

=== BREAKING

* Backend simplified to represent a backend for the Store rather than being a store itself, Store is now a wrapper around a backend to provide additional functionality and a monadic interface. Decorators still wrap stores. Decorators are also now wrapping a backend instead of a store.

Now if you just want a typed wrapper around an existing cache store, you can do:

```ruby
store = TypedCache.builder.with_backend(:active_support, Rails.cache)

# Store provides helper methods and monadic results for safe cache operations,
# but you can also retrieve the underlying backend and use it di
user_store = store.cache_for(User)

# Elsewhere in your code
cache = store.cache_for(User).backend # => Backend[User]

# 'cache' is now a typed backend, so you can use it as a lightweight wrapper
# around Rails.cache, but with type safety. However, you lose the ability to use
# CacheRef and the monadic interface. Decorators and instrumentation still work.
cache.read('user') # => User?
```

Although backends do not use monadic results or CacheRef, this will likely change in the future as CacheRef is a core part of the library and needs more improvement while the monadic, snapshot-based results of Store may need to be simplified or reorganized. These planned changes will likely allow backends to use CacheRef as well as collections of CacheRefs and opt into monadic results.

== 0.3.2

* types: Include updated RBS signatures for 0.3.1

== 0.3.1

* feat: Added `**kwargs` to `Store` methods to allow passing options to the underlying cache store for `read`, `write`, `read_all`, `write_all`, `fetch`, and `fetch_all`.

== 0.3.0

* BREAKING: Renamed get/set methods to read/write

* feat: Added `fetch_all` method to `Store` interface.
* feat: Added `get_all`/`set_all` methods to `Store` interface.
* feat: Added `key` attribute to `Snapshot` to provide access to the key that was used to retrieve the value.
* feat: Instrumented `fetch_all` method, without instrumenting nested cache calls.
* feat: Allow providing an array of namespace entries to `with_namespace` to create a nested namespace.
* feat(rails): Added a Railtie to automatically configure the gem when Rails is present.
* feat(sorbet): Added public API for gem under rbi directory.
* feat(namespaces): `.at` now accepts multiple arguments, automatically chaining with the appropriate delimiter.
* feat(namespaces): Added `#join` method to `Namespace` to explicitly join multiple namespaces, with or without custom key factories.
* feat: Support for custom cache delimiters besides '.' or ':'.
* feat: Added `right_or_else` and `right_or_raise!` methods to `Either` class.

* fix(namespaces): Fixed a bug where instrumenters would not properly resolve namespaces.
* fix(rbs): Adjusted some erroneous RBS comments.=

* chore(sorbet): Initialized sorbet via tapioca.

* refactor: fetch method blocks may return nil.
* refactor: fetch/fetch_all methods now return a `Snapshot` with a `maybe[V]` value.
* refactor: Store methods return arrays of snapshots, not hashes.
* refactor: Added a `cached` factory method to `Snapshot`.
* refactor: fetch_all now accepts a block that receives the CacheKey, not the raw string key.

== 0.2.0

* refactor(instrumentation): Reworked the `CacheBuilder`'s instrumentation API for clarity and flexibility. The `with_instrumentation` method now accepts `:rails`, `:dry`, `:default` (null), or a custom instrumenter instance directly.
* fix(instrumentation): Corrected a bug where instrumenters would still publish events even when `config.instrumentation.enabled` was set to `false`.
* fix(instrumentation): Allowed subscriptions to be registered on disabled instrumenters; they will simply not fire any events.
* feat(docs): Overhauled the `README.md` and `examples.md` to be more comprehensive, featuring the `CacheRef` API more prominently and adding detailed examples for custom backends and instrumenters.
* test(core): Added extensive test coverage for the `CacheBuilder` and instrumentation logic to ensure correctness and prevent regressions.
* chore(tests): Refactored test suites to improve clarity and maintainability by adhering to a "one expectation per example" convention and using `let` blocks for setup.

== 0.1.1

* chore: update gemspec details

== 0.1.0

* Added robust, type-safe caching library with monadic results
* Implemented core features:
  - Monadic cache operations with explicit `Either` result types
  - Immutable cache objects with rich metadata (source, age)
  - Flexible backend implementations with consistent `Store` interface
  - Support for ActiveSupport::Cache backend out of the box
* Introduced namespacing to prevent key collisions
* Added instrumentation decorator for cache operation tracking
* Provided RBS type signatures for strong type safety
* Implemented error handling with comprehensive cache miss and store error scenarios


== 0.0.0

* Added initial implementation.
